# M4: Test Package for Article Computation
# Purpose: Test Rules engine with article coordination

id: test.article
version: 1.0.0

metadata:
  name: Article Test Package
  description: Test article coordination via Rules
  authors:
    - RPG Spec Team
  bypass_filters: false

namespaces:
  test:
    id: test

    datatypes:
      colors:
        name: colors
        values:
          - text: red
            tags:
              article: a
              phonetic: consonant
            weight: 1
          - text: blue
            tags:
              article: a
              phonetic: consonant
            weight: 1
          - text: orange
            tags:
              article: an
              phonetic: vowel
            weight: 1
          - text: emerald
            tags:
              article: an
              phonetic: vowel
            weight: 1

      objects:
        name: objects
        values:
          - text: ball
            tags:
              article: a
              plural: balls
            weight: 1
          - text: apple
            tags:
              article: an
              plural: apples
            weight: 1
          - text: umbrella
            tags:
              article: an
              plural: umbrellas
            weight: 1

    # M4: Rules execute during enrichment phase
    rules:
      compute_article:
        when: "ref:color.tags.article"
        logic: ""
        set: "context.prompt.article"
        value: "ref:color.tags.article"

    prompt_sections:
      # M4: With article from Rules
      with_article:
        name: with_article
        template: "{article} {color} {object}"
        references:
          color:
            target: test:colors
            min: 1
            max: 1
          object:
            target: test:objects
            min: 1
            max: 1
          article:
            target: context:article  # Read from context
            min: 1
            max: 1

      # M3: Without article (still works)
      simple:
        name: simple
        template: "{color} {object}"
        references:
          color:
            target: test:colors
            min: 1
            max: 1
          object:
            target: test:objects
            min: 1
            max: 1

