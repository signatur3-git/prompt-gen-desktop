# M5 Phase 3+4: Lists and Separator Sets Test Package

id: test.lists
version: 1.0.0

metadata:
  name: "Lists and Separator Sets Test"
  description: "Tests M5 Phase 3+4 - min/max multiplicity and separator sets"
  authors: ["RPG Dev Team"]
  bypass_filters: false

namespaces:
  test:
    id: test

    # Datatypes
    datatypes:
      colors:
        name: colors
        values:
          - text: "red"
            weight: 1
          - text: "blue"
            weight: 1
          - text: "green"
            weight: 1
          - text: "yellow"
            weight: 1
          - text: "purple"
            weight: 1

      adjectives:
        name: adjectives
        values:
          - text: "beautiful"
            weight: 1
          - text: "mysterious"
            weight: 1
          - text: "ancient"
            weight: 1
          - text: "magical"
            weight: 1

      # For sanity check: creatures with article tags
      creatures:
        name: creatures
        values:
          - text: "owl"
            tags:
              can_fly: true
              article: "an"
            weight: 1

          - text: "eagle"
            tags:
              can_fly: true
              article: "an"
            weight: 1

          - text: "swan"
            tags:
              can_fly: true
              article: "a"
            weight: 1

          - text: "bat"
            tags:
              can_fly: true
              article: "a"
            weight: 1

          - text: "deer"
            tags:
              can_fly: false
              article: "a"
            weight: 1

    # Separator sets
    separator_sets:
      comma_and:
        name: comma_and
        primary: ", "
        secondary: " and "

      comma_or:
        name: comma_or
        primary: ", "
        secondary: " or "

      semicolon:
        name: semicolon
        primary: "; "
        secondary: "; "

    # Rules for sanity check
    rules:
      compute_article_from_creatures:
        when: "ref:creatures.tags.article"
        logic: ""
        set: "context.prompt.article"
        value: "ref:creatures.tags.article"

    # Prompt sections
    prompt_sections:
      # Test 1: Simple list (space-separated, default)
      simple_list:
        name: simple_list
        template: "{colors}"
        references:
          colors:
            target: test:colors
            min: 2
            max: 4
        # Expected: "red blue green" or "red blue green yellow" etc.

      # Test 2: Natural list with comma_and
      natural_list:
        name: natural_list
        template: "{colors}"
        references:
          colors:
            target: test:colors
            min: 2
            max: 3
            separator: comma_and
        # Expected: "red and blue" or "red, blue and green"

      # Test 3: Unique constraint
      unique_colors:
        name: unique_colors
        template: "{colors}"
        references:
          colors:
            target: test:colors
            min: 3
            max: 3
            separator: comma_and
            unique: true
        # Expected: "red, blue and green" (always 3 different colors)

      # Test 4: Optional items (min=0)
      optional_adjectives:
        name: optional_adjectives
        template: "A {adjectives} castle"
        references:
          adjectives:
            target: test:adjectives
            min: 0
            max: 2
            separator: comma_and
        # Expected: "A castle" (0) or "A beautiful castle" (1) or "A beautiful and mysterious castle" (2)

      # Test 5: Different separator (comma_or)
      or_list:
        name: or_list
        template: "Choose {colors}"
        references:
          colors:
            target: test:colors
            min: 2
            max: 3
            separator: comma_or
        # Expected: "Choose red or blue" or "Choose red, blue or green"

      # SANITY CHECK: M4 + M5 Integration
      # Tests: tag filtering (M4) + article computation (M4) + min/max (M5) + separator sets (M5)
      flying_creatures_with_article:
        name: flying_creatures_with_article
        template: "{article} {creatures}"
        references:
          article:
            target: context:article
          creatures:
            target: test:creatures
            min: 2
            max: 3
            separator: comma_and
            filter: "tags.can_fly"
        # Expected: "an owl, eagle and swan" or "a swan and bat" etc.
        # Article should match first creature
        # Only flying creatures (owl, eagle, swan, bat - NOT deer)

dependencies: []

